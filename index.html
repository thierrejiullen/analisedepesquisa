<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Consulta - Cruzamento de Leads e Pesquisa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f3f6;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            background-color: #ffffff;
        }
        .card-header {
            border-bottom: 2px solid #3498db;
            color: #2c3e50;
            font-weight: bold;
            padding: 15px 20px;
        }
        .btn-primary {
            background-color: #3498db;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-success {
            background-color: #2ecc71;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-danger {
            background-color: #e74c3c;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .upload-area {
            border: 1px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            background-color: #f8f9fa;
            margin: 10px 0;
            cursor: pointer;
        }
        .table-header-green {
            background-color: #2ecc71;
            color: white;
        }
        .table-header-blue {
            background-color: #3498db;
            color: white;
        }
        .nav-tabs .nav-link.active {
            border-top: 3px solid #3498db;
        }
        .high-score {
            background-color: #d5f5e3;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Sistema de Consulta - Cruzamento de Leads e Pesquisa</h1>
        
        <!-- Seção 1: Upload e Cruzamento -->
        <div class="card">
            <div class="card-header">
                <h3>Upload e Cruzamento de Dados</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Arquivo de Leads (CSV ou Excel):</label>
                        <div class="upload-area" id="upload-leads">
                            Arraste e solte ou <a href="#" class="text-primary fw-bold">selecione um arquivo</a>
                            <input type="file" id="leads-file" class="d-none">
                        </div>
                        <div id="leads-status"></div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Arquivo de Pesquisa (CSV ou Excel):</label>
                        <div class="upload-area" id="upload-pesquisa">
                            Arraste e solte ou <a href="#" class="text-primary fw-bold">selecione um arquivo</a>
                            <input type="file" id="pesquisa-file" class="d-none">
                        </div>
                        <div id="pesquisa-status"></div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <button id="cruzar-btn" class="btn btn-primary btn-lg px-4">Cruzar Dados</button>
                </div>
                <div id="cruzamento-status" class="mt-3 text-center"></div>
            </div>
        </div>
        
        <!-- Seção 2: Filtros -->
        <div class="card">
            <div class="card-header">
                <h3>Filtros de Consulta</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">UTM Term:</label>
                            <select id="utm-term-select" class="form-select" multiple>
                                <option value="" disabled>Carregando opções...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Faixa de Renda:</label>
                            <select id="renda-select" class="form-select" multiple>
                                <option value="" disabled>Carregando opções...</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">UTM Source:</label>
                            <select id="utm-source-select" class="form-select" multiple>
                                <option value="" disabled>Carregando opções...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">UTM Medium:</label>
                            <select id="utm-medium-select" class="form-select" multiple>
                                <option value="" disabled>Carregando opções...</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">UTM Campaign:</label>
                    <select id="utm-campaign-select" class="form-select" multiple>
                        <option value="" disabled>Carregando opções...</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Busca por Email:</label>
                    <input type="text" id="email-search" class="form-control" placeholder="Digite um email para buscar...">
                </div>
                <div class="d-flex justify-content-center mt-3">
                    <button id="apply-filters" class="btn btn-success btn-lg me-3">Aplicar Filtros</button>
                    <button id="clear-filters" class="btn btn-danger btn-lg">Limpar Filtros</button>
                </div>
                <div class="mt-4 text-center">
                    <label class="form-label fw-bold d-block">Download dos Resultados:</label>
                    <button id="download-btn" class="btn btn-primary btn-lg px-4 mt-2">Download CSV</button>
                </div>
            </div>
        </div>
        
        <!-- Seção 3: Visualizações -->
        <div class="card">
            <div class="card-header">
                <h3>Visualizações</h3>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="visualizacoes-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="heatmap-tab" data-bs-toggle="tab" data-bs-target="#heatmap-content" type="button" role="tab" aria-controls="heatmap-content" aria-selected="true">Distribuição de Renda por UTM Term</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="bar-tab" data-bs-toggle="tab" data-bs-target="#bar-content" type="button" role="tab" aria-controls="bar-content" aria-selected="false">Comparação de UTM Terms</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pie-tab" data-bs-toggle="tab" data-bs-target="#pie-content" type="button" role="tab" aria-controls="pie-content" aria-selected="false">Distribuição de Renda</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="table-tab" data-bs-toggle="tab" data-bs-target="#table-content" type="button" role="tab" aria-controls="table-content" aria-selected="false">Dados Detalhados</button>
                    </li>
                </ul>
                <div class="tab-content p-3" id="visualizacoes-content">
                    <div class="tab-pane fade show active" id="heatmap-content" role="tabpanel" aria-labelledby="heatmap-tab">
                        <div id="heatmap-container" style="height: 600px;">
                            <div class="text-center py-5">
                                <h4 class="text-muted">Carregue os dados para visualizar o heatmap</h4>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="bar-content" role="tabpanel" aria-labelledby="bar-tab">
                        <div id="bar-container" style="height: 600px;">
                            <div class="text-center py-5">
                                <h4 class="text-muted">Carregue os dados para visualizar o gráfico de barras</h4>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pie-content" role="tabpanel" aria-labelledby="pie-tab">
                        <div id="pie-container" style="height: 600px;">
                            <div class="text-center py-5">
                                <h4 class="text-muted">Carregue os dados para visualizar o gráfico de pizza</h4>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="table-content" role="tabpanel" aria-labelledby="table-tab">
                        <h4 class="text-center mt-3 mb-2">Resultados da Consulta</h4>
                        <div id="results-count" class="text-center mb-3 fw-bold"></div>
                        <div class="table-responsive">
                            <table id="results-table" class="table table-striped">
                                <thead class="table-header-blue">
                                    <tr>
                                        <th>UTM Term</th>
                                        <th>Email</th>
                                        <th>Faixa de Renda</th>
                                        <th>UTM Source</th>
                                        <th>UTM Medium</th>
                                        <th>UTM Campaign</th>
                                        <th>Gênero</th>
                                        <th>Idade</th>
                                        <th>Estado</th>
                                        <th>Atividade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="10" class="text-center">Nenhum dado disponível</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Seção 4: Tabela de Criativos com Renda Alta -->
        <div class="card">
            <div class="card-header text-center">
                <h3>Criativos com Maior Número de Leads com Renda Acima de R$2.000</h3>
            </div>
            <div class="card-body">
                <div id="criativos-renda-alta-info" class="text-center mb-3 fw-bold"></div>
                <div class="table-responsive">
                    <table id="tabela-criativos-renda-alta" class="table table-striped">
                        <thead class="table-header-green">
                            <tr>
                                <th>UTM Term</th>
                                <th>Quantidade de Leads</th>
                                <th>Porcentagem (%)</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="text-center">Nenhum dado disponível</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensagem de carregamento -->
    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 9999;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border-radius: 10px; text-align: center;">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <h4 id="loading-message">Processando dados...</h4>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.18.0/plotly.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
